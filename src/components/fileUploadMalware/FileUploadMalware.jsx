import React from 'react';
import "./FileUpload.scss";
import Result from '../../pages/result/Result';
class FileUploadMalware extends React.Component {
  constructor(props) {
    super(props);

    this.state = {
      data: '',
      resp: '',
      proto:''
    };

    this.handleUploadImage = this.handleUploadImage.bind(this);
  }

  onProtoChanged=e=>{
    this.setState({[e.target.name]:e.target.value})
    console.log(e.target.value)
    console.log("hi"+this.state.proto)
    
}

  handleUploadImage(ev) {
    ev.preventDefault();

    const data = new FormData();
    data.append('file', this.uploadInput.files[0]);
    data.append('proto', this.state.proto);
    console.log(data)

    fetch('http://localhost:5000/uploadMalware', {
      method: 'POST',
      body: data,
    } 
    ).then((response) => {
      console.log(response.body)
      response.json().then((body) => {
        console.log(body)

        this.setState({resp: body})
        console.log(this.state.resp)
        
      
      }  );
    });
  }

  render() {
    return (
      <div>
      <div className='upload'>   
         <form onSubmit={this.handleUploadImage}>
        <div>
          <input ref={(ref) => { this.uploadInput = ref; }} type="file" />
        </div>
        <div>
        </div>
        <br />
        <div>
        
        
        <p>Select Scan Type:</p>
  <input type="radio" id="http" name="proto" value="HTTP" onChange={this.onProtoChanged} />
  <label for="http">HTTP</label><br/>
  <input type="radio" id="dns" name="proto" value="DNS" onChange={this.onProtoChanged}/>
  <label for="dns">DNS</label><br/>
  <input type="radio" id="ip" name="proto" value="IP" onChange={this.onProtoChanged}/>
  <label for="ip">IP</label>

  <br/>  

        <button>Upload</button>
          
        </div>
        
      </form>
      </div>
      
      
     
      {this.state.resp!=''? <div><Result res={this.state.resp.response}/> {+localStorage.setItem('malcount',(+this.state.resp.malcount+ +localStorage.getItem('malcount')))} </div> :''}

      </div>
    );
  }
}

export default FileUploadMalware;